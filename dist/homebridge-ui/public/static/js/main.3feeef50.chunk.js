(this["webpackJsonphomebridge-ui"]=this["webpackJsonphomebridge-ui"]||[]).push([[0],{22:function(e,t,n){"use strict";n.r(t);var r=n(13),c=n.n(r),o=n(2),s=n.n(o),a=n(12),i=n(15),u=n(14),p=n(5),f=n(6),d=n(0),m=(n(11),n(1)),h=window.homebridge;function l(e){var t=e.onRefreshToken,n=Object(d.useState)(!1),r=Object(f.a)(n,2),c=r[0],o=r[1],a=Object(d.useState)(),i=Object(f.a)(a,2),u=i[0],l=i[1];return Object(d.useEffect)((function(){c?h.showSpinner():h.hideSpinner()}),[c]),Object(d.useEffect)((function(){if(u){var e=h.createForm({schema:{type:"object",properties:{code:{title:"Code",type:"string",required:!0,description:u.codePrompt}}}},{},"Link Account","Change Email");e.onSubmit(function(){var e=Object(p.a)(s.a.mark((function e(n){var r,c,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.code,o(!0),e.prev=2,e.next=5,h.request("/token",{email:u.email,password:u.password,code:r});case 5:c=e.sent,a=c.refreshToken,t(a),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),console.error(e.t0),h.toast.error(e.t0.message,"Failed to Link Account");case 14:return e.prev=14,o(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,10,14,17]])})));return function(t){return e.apply(this,arguments)}}()),e.onCancel((function(){return l(void 0)}))}else{h.createForm({schema:{type:"object",properties:{email:{title:"Email",type:"string","x-schema-form":{type:"email"},required:!0},password:{title:"Password",type:"string","x-schema-form":{type:"password"},required:!0}}}},{},"Log In").onSubmit(function(){var e=Object(p.a)(s.a.mark((function e(n){var r,c,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.email,c=n.password,o(!0),e.next=4,new Promise((function(e){return setTimeout(e,1e3)}));case 4:return e.prev=4,e.next=7,h.request("/send-code",{email:r,password:c});case 7:"refreshToken"in(a=e.sent)?t(a.refreshToken):l({email:r,password:c,codePrompt:a.codePrompt}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),console.error(e.t0),h.toast.error(e.t0.message,"Vivint Login Failed");case 15:return e.prev=15,o(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,11,15,18]])})));return function(t){return e.apply(this,arguments)}}())}}),[t,u]),Object(m.jsx)("h4",{className:"text-center primary-text mb-3",children:"Link Vivint Account"})}var b=window.homebridge;function j(){return b.getPluginConfig()}function v(){var e=Object(d.useState)(!1),t=Object(f.a)(e,2),n=t[0],r=t[1];function c(){return(c=Object(p.a)(s.a.mark((function e(t){var n,c,o,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:return n=e.sent,c=Object(u.a)(n),o=c[0],p=c.slice(1),e.next=8,b.updatePluginConfig([Object(a.a)(Object(a.a)({},o),{},{refreshToken:t})].concat(Object(i.a)(p)));case 8:b.toast.success("Refresh Token Updated","Vivint Login Successful"),r(!1);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(d.useEffect)((function(){n?b.hideSchemaForm():b.showSchemaForm()}),[n]),Object(d.useEffect)((function(){j().then((function(e){var t,n=!(null===(t=e[0])||void 0===t?void 0:t.refreshToken);r(n)}))}),[]),n?Object(m.jsx)(l,{onRefreshToken:function(e){return c.apply(this,arguments)}}):Object(m.jsxs)("button",{className:"btn btn-link m-0 p-0",onClick:function(){return r(!0)},children:[Object(m.jsx)("i",{className:"fa fa-redo mr-2"}),"Generate New Refresh Token"]})}window.homebridge.addEventListener("ready",(function(){c.a.render(Object(m.jsx)(v,{}),document.getElementById("root"))}))}},[[22,1,2]]]);
//# sourceMappingURL=main.3feeef50.chunk.js.map